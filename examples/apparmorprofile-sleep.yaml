policy: |2
  # Generated by https://github.com/kubernetes-sigs/security-profiles-operator, do not edit by hand.
  #include <tunables/global>
  profile test-sleep flags=(attach_disconnected,mediate_deleted) {
    #include <abstractions/base>

    # Executable rules

    /bin/busybox ix,


    /lib/ld-musl-x86_64.so.1 mr,


    # Filesystem rules

    /proc/@{pid}/cgroup r,
    /proc/@{pid}/mounts r,
    /proc/@{pid}/setgroups r,
    /proc/@{pid}/uid_map r,
    /proc/sys/kernel/cap_last_cap r,
    /run r,
    /sys/module/apparmor/parameters/enabled r,

    deny /proc/@{pid}/cgroup wlk,
    deny /proc/@{pid}/mounts wlk,
    deny /proc/@{pid}/setgroups wlk,
    deny /proc/@{pid}/uid_map wlk,
    deny /proc/sys/kernel/cap_last_cap wlk,
    deny /run wlk,
    deny /sys/module/apparmor/parameters/enabled wlk,


    /etc/alpine-release wlk,
    /etc/apk/arch wlk,
    /etc/apk/keys/alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub wlk,
    /etc/apk/keys/alpine-devel@lists.alpinelinux.org-5243ef4b.rsa.pub wlk,
    /etc/apk/keys/alpine-devel@lists.alpinelinux.org-5261cecb.rsa.pub wlk,
    /etc/apk/keys/alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub wlk,
    /etc/apk/keys/alpine-devel@lists.alpinelinux.org-61666e3f.rsa.pub wlk,
    /etc/apk/repositories wlk,
    /etc/apk/world wlk,
    /etc/busybox-paths.d/busybox wlk,
    /etc/crontabs/root wlk,
    /etc/fstab wlk,
    /etc/group wlk,
    /etc/hostname wlk,
    /etc/hosts wlk,
    /etc/inittab wlk,
    /etc/issue wlk,
    /etc/logrotate.d/acpid wlk,
    /etc/modprobe.d/aliases.conf wlk,
    /etc/modprobe.d/blacklist.conf wlk,
    /etc/modprobe.d/i386.conf wlk,
    /etc/modprobe.d/kms.conf wlk,
    /etc/modules wlk,
    /etc/motd wlk,
    /etc/network/if-up.d/dad wlk,
    /etc/nsswitch.conf wlk,
    /etc/os-release wlk,
    /etc/profile wlk,
    /etc/profile.d/20locale.sh wlk,
    /etc/profile.d/README wlk,
    /etc/profile.d/color_prompt.sh.disabled wlk,
    /etc/protocols wlk,
    /etc/secfixes.d/alpine wlk,
    /etc/securetty wlk,
    /etc/services wlk,
    /etc/shadow wlk,
    /etc/shells wlk,
    /etc/ssl/certs/ca-certificates.crt wlk,
    /etc/ssl/ct_log_list.cnf wlk,
    /etc/ssl/ct_log_list.cnf.dist wlk,
    /etc/ssl/openssl.cnf wlk,
    /etc/ssl/openssl.cnf.dist wlk,
    /etc/sysctl.conf wlk,
    /etc/udhcpc/udhcpc.conf wlk,
    /lib/apk/db/installed wlk,
    /lib/apk/db/lock wlk,
    /lib/apk/db/scripts.tar wlk,
    /lib/apk/db/triggers wlk,
    /lib/libapk.so.2.14.0 wlk,
    /lib/libcrypto.so.3 wlk,
    /lib/libssl.so.3 wlk,
    /lib/libz.so.1.3.1 wlk,
    /lib/sysctl.d/00-alpine.conf wlk,
    /sbin/apk wlk,
    /sbin/ldconfig wlk,
    /usr/bin/getconf wlk,
    /usr/bin/getent wlk,
    /usr/bin/iconv wlk,
    /usr/bin/ldd wlk,
    /usr/bin/scanelf wlk,
    /usr/bin/ssl_client wlk,
    /usr/lib/engines-3/afalg.so wlk,
    /usr/lib/engines-3/capi.so wlk,
    /usr/lib/engines-3/loader_attic.so wlk,
    /usr/lib/engines-3/padlock.so wlk,
    /usr/lib/ossl-modules/legacy.so wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-5243ef4b.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-524d27bb.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-5261cecb.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-58199dcc.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-58cbb476.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-58e4f17d.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-5e69ca50.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-60ac2099.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-61666e3f.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616a9724.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616abc23.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616ac3bc.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616adfeb.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616ae350.rsa.pub wlk,
    /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616db30d.rsa.pub wlk,
    /usr/share/udhcpc/default.script wlk,

    deny /etc/alpine-release r,
    deny /etc/apk/arch r,
    deny /etc/apk/keys/alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub r,
    deny /etc/apk/keys/alpine-devel@lists.alpinelinux.org-5243ef4b.rsa.pub r,
    deny /etc/apk/keys/alpine-devel@lists.alpinelinux.org-5261cecb.rsa.pub r,
    deny /etc/apk/keys/alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub r,
    deny /etc/apk/keys/alpine-devel@lists.alpinelinux.org-61666e3f.rsa.pub r,
    deny /etc/apk/repositories r,
    deny /etc/apk/world r,
    deny /etc/busybox-paths.d/busybox r,
    deny /etc/crontabs/root r,
    deny /etc/fstab r,
    deny /etc/group r,
    deny /etc/hostname r,
    deny /etc/hosts r,
    deny /etc/inittab r,
    deny /etc/issue r,
    deny /etc/logrotate.d/acpid r,
    deny /etc/modprobe.d/aliases.conf r,
    deny /etc/modprobe.d/blacklist.conf r,
    deny /etc/modprobe.d/i386.conf r,
    deny /etc/modprobe.d/kms.conf r,
    deny /etc/modules r,
    deny /etc/motd r,
    deny /etc/network/if-up.d/dad r,
    deny /etc/nsswitch.conf r,
    deny /etc/os-release r,
    deny /etc/profile r,
    deny /etc/profile.d/20locale.sh r,
    deny /etc/profile.d/README r,
    deny /etc/profile.d/color_prompt.sh.disabled r,
    deny /etc/protocols r,
    deny /etc/secfixes.d/alpine r,
    deny /etc/securetty r,
    deny /etc/services r,
    deny /etc/shadow r,
    deny /etc/shells r,
    deny /etc/ssl/certs/ca-certificates.crt r,
    deny /etc/ssl/ct_log_list.cnf r,
    deny /etc/ssl/ct_log_list.cnf.dist r,
    deny /etc/ssl/openssl.cnf r,
    deny /etc/ssl/openssl.cnf.dist r,
    deny /etc/sysctl.conf r,
    deny /etc/udhcpc/udhcpc.conf r,
    deny /lib/apk/db/installed r,
    deny /lib/apk/db/lock r,
    deny /lib/apk/db/scripts.tar r,
    deny /lib/apk/db/triggers r,
    deny /lib/libapk.so.2.14.0 r,
    deny /lib/libcrypto.so.3 r,
    deny /lib/libssl.so.3 r,
    deny /lib/libz.so.1.3.1 r,
    deny /lib/sysctl.d/00-alpine.conf r,
    deny /sbin/apk r,
    deny /sbin/ldconfig r,
    deny /usr/bin/getconf r,
    deny /usr/bin/getent r,
    deny /usr/bin/iconv r,
    deny /usr/bin/ldd r,
    deny /usr/bin/scanelf r,
    deny /usr/bin/ssl_client r,
    deny /usr/lib/engines-3/afalg.so r,
    deny /usr/lib/engines-3/capi.so r,
    deny /usr/lib/engines-3/loader_attic.so r,
    deny /usr/lib/engines-3/padlock.so r,
    deny /usr/lib/ossl-modules/legacy.so r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-5243ef4b.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-524d27bb.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-5261cecb.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-58199dcc.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-58cbb476.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-58e4f17d.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-5e69ca50.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-60ac2099.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-61666e3f.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616a9724.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616abc23.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616ac3bc.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616adfeb.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616ae350.rsa.pub r,
    deny /usr/share/apk/keys/alpine-devel@lists.alpinelinux.org-616db30d.rsa.pub r,
    deny /usr/share/udhcpc/default.script r,


    /dev/null rwlk,
    /etc/passwd rwlk,
    /proc/@{pid}/oom_score_adj rwlk,


    # Network rules


    # Capabilities rules
    capability chown,
    capability dac_override,
    capability dac_read_search,
    capability fsetid,
    capability mknod,
    capability setgid,
    capability setpcap,
    capability sys_admin,


    # Raw rules placeholder

    # Add default deny for known information leak/priv esc paths
    deny @{PROC}/* w,   # deny write for all files directly in /proc (not in a subdir)
    deny @{PROC}/{[^1-9],[^1-9][^0-9],[^1-9s][^0-9y][^0-9s],[^1-9][^0-9][^0-9][^0-9]*}/** w,
    deny @{PROC}/sys/[^k]** w,  # deny /proc/sys except /proc/sys/k* (effectively /proc/sys/kernel)
    deny @{PROC}/sys/kernel/{?,??,[^s][^h][^m]**} w,  # deny everything except shm* in /proc/sys/kernel/
    deny @{PROC}/sysrq-trigger rwklx,
    deny @{PROC}/mem rwklx,
    deny @{PROC}/kmem rwklx,
    deny @{PROC}/kcore rwklx,
    deny mount,
    deny /sys/[^f]*/** wklx,
    deny /sys/f[^s]*/** wklx,
    deny /sys/fs/[^c]*/** wklx,
    deny /sys/fs/c[^g]*/** wklx,
    deny /sys/fs/cg[^r]*/** wklx,
    deny /sys/firmware/efi/efivars/** rwklx,
    deny /sys/kernel/security/** rwklx,
  }
