# This is the cluster wide security-profiles-operator deployment, which listens for
# configMaps on all namespaces
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

sortOptions:
  order: fifo

resources:
- ../../base
patches:
- path: operator-profile.yaml
  target:
    kind: (ServiceAccount|Role|ClusterRoleBinding|RoleBinding|Secret)

- patch: |
    - op: replace
      path: /subjects/0/namespace
      value: "{{ .Release.Namespace }}"
  target:
    kind: (ClusterRoleBinding|RoleBinding)

- patch: |
    - op: replace
      path: /metadata/name
      value: "{{ .Release.Namespace }}"
  target:
    kind: Namespace
